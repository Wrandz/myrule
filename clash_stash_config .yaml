# åŒ…å« Stash å’Œ Clash çš„å®Œæ•´é…ç½®ç¤ºä¾‹
# æ‰€æœ‰é…ç½®å­—æ®µéƒ½æ˜¯ Stash å’Œ Clash å…±åŒæ”¯æŒçš„ï¼Œç›¸äº’ä¸æ”¯æŒçš„éƒ¨åˆ†å·²åšå•ç‹¬è¯´æ˜
# ä½¿ç”¨ Stash åº”å½“åˆ é™¤ Stash å°šä¸æ”¯æŒçš„éƒ¨åˆ† Clash è®¾ç½®ï¼Œä½¿ç”¨ Clash (Clash for Windows / ClashX) åº”å½“åˆ é™¤ Stash åˆ›é€ çš„åªæœ‰ Stash æ”¯æŒçš„éƒ¨åˆ†è®¾ç½®
# https://raw.githubusercontent.com/STASH-NETWORKS-LIMITED/stash-example/main/config.yaml
# https://lancellc.gitbook.io/clash/clash-config-file/an-example-configuration-file


# --------------------------------------------------
# Clash ç›¸å…³é…ç½®ï¼ŒStash æ–‡æ¡£æœªæ³¨æ˜æ”¯æŒ

# Port of HTTP(S) proxy server on the local end
port: 7890

# Port of SOCKS5 proxy server on the local end
socks-port: 7891

# Transparent proxy server port for Linux and macOS (Redirect TCP and TProxy UDP)
# redir-port: 7892

# Transparent proxy server port for Linux (TProxy TCP and TProxy UDP)
# tproxy-port: 7893

# HTTP(S) and SOCKS4(A)/SOCKS5 server on the same port
# mixed-port: 7890

# authentication of local SOCKS5/HTTP(S) server
# authentication:
#  - "user1:pass1"
#  - "user2:pass2"

# Set to true to allow connections to the local-end server from other LAN IP addresses
allow-lan: false

# This is only applicable when `allow-lan` is `true`
# '*': bind all IP addresses
# 192.168.122.11: bind a single IPv4 address
# "[aaaa::a8aa:ff:fe09:57d8]": bind a single IPv6 address
bind-address: '*'

# Clash å†…æ ¸çš„å¤–éƒ¨æ§åˆ¶ç«¯å£ï¼Œè¿™é‡Œæ²¡åŠ  secret
# https://github.com/Dreamacro/clash-dashboard/tree/gh-pages
# ä¸‹è½½ç¼–è¯‘å¥½çš„ clash-dashboard æ”¾ç½®äºæŒ‡å®šç›®å½•ï¼Œå³å¯å¤–éƒ¨æµè§ˆå™¨è®¿é—®
external-controller : 0.0.0.0:9090
external-ui : /root/clashui

# --------------------------------------------------

# Clash è·¯ç”±å·¥ä½œæ¨¡å¼
# è§„åˆ™æ¨¡å¼ï¼šrule (è§„åˆ™) / global (å…¨å±€ä»£ç†) / direct (å…¨å±€ç›´è¿)
mode: rule

# Clash é»˜è®¤å°†æ—¥å¿—è¾“å‡ºè‡³ STDOUT
# è®¾ç½®æ—¥å¿—è¾“å‡ºçº§åˆ« (é»˜è®¤çº§åˆ«ï¼šsilentï¼Œå³ä¸è¾“å‡ºä»»ä½•å†…å®¹ï¼Œä»¥é¿å…å› æ—¥å¿—å†…å®¹è¿‡å¤§è€Œå¯¼è‡´ç¨‹åºå†…å­˜æº¢å‡º)ã€‚
# 5 ä¸ªçº§åˆ«ï¼šsilent / info / warning / error / debugã€‚çº§åˆ«è¶Šé«˜æ—¥å¿—è¾“å‡ºé‡è¶Šå¤§ï¼Œè¶Šå€¾å‘äºè°ƒè¯•ï¼Œè‹¥éœ€è¦è¯·è‡ªè¡Œå¼€å¯ã€‚
log-level: info

# --------------------------------------------------
# Stash ç›¸å…³é…ç½®ï¼ŒClash æ–‡æ¡£æœªæ³¨æ˜æ”¯æŒ

# æ”¹å†™ä¸ MitM ç›¸å…³ (Beta)
http:
  # å¼ºåˆ¶ä½¿ç”¨ Stash Engine ä»¥ HTTP åè®®å¤„ç† TCP è¿æ¥
  # æ•è·åçš„è¿æ¥å¯ä»¥ä½¿ç”¨é«˜çº§åŠŸèƒ½ï¼Œä¾‹å¦‚é‡å†™å’Œè„šæœ¬
  force-http-engine:
    - "*:80"
    - "*:4480" # BiliBili CDN
    - "*:9102" # BiliBili CDN

  # ä»¥ PKCS #12 ç¼–ç çš„ CA è¯ä¹¦
  # æ­¤å¤„è¡¨ç¤ºè‡ªå®šä¹‰çš„ CA è¯ä¹¦ï¼Œè‹¥ä½¿ç”¨ Stash GUI ç•Œé¢çš„ CA è¯ä¹¦å®‰è£…ï¼Œé…ç½®æ–‡ä»¶ä¸­æ— éœ€è®¾ç½®ï¼Œç•™ç©ºå³å¯ï¼ŒStash ä¼šè‡ªåŠ¨å¡«å……
  ca: ""
  # è¯ä¹¦å¯†ç 
  ca-passphrase: ""
  # å¼€å¯ MitM åŠŸèƒ½çš„åŸŸååˆ—è¡¨ï¼Œéœ€è¦ç¡®ä¿ä¸Šè¿° CA è¯ä¹¦å·²å—ç³»ç»Ÿä¿¡ä»»
  mitm:
    - g.cn
    - "*.google.cn"
    - weather-data.apple.com # é»˜è®¤åªå¯¹ 443 ç«¯å£å¼€å¯
    - weather-data.apple.com:* # ä½¿ç”¨é€šé…ç¬¦å¯¹æ‰€æœ‰ç«¯å£å¼€å¯
    - "*.weather-data.apple.com" # åŸŸåä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨é€šé…ç¬¦
  # HTTP(S) é‡å†™ï¼Œæ”¯æŒheaderã€302ã€307ã€rejectå¤šç§ç­–ç•¥
  rewrite:
    - ^http://g\.cn http://www.google.com header # é‡å†™è¯·æ±‚å¤´çš„åŸŸå
    - ^https?://www\.google\.cn https://www.google.com 302 # ç›´æ¥è¿”å›ä¸€ä¸ª 302 é‡å®šå‘çš„å“åº”
    - ^https?://ad\.example - reject # æ‹’ç»è¯·æ±‚
  # ä½¿ç”¨ JavaScript è„šæœ¬æ”¹å†™ HTTP(S) è¯·æ±‚
  script:
    - match: https://weather-data.apple.com/v2/weather/[\w-]+/-?[0-9]+\.[0-9]+/-?[0-9]+\.[0-9]+\?
      name: weather-us-aqi # å¼•ç”¨script-providersä¸­çš„è„šæœ¬
      type: response # è„šæœ¬ç±»å‹ï¼šrequest / response
      require-body: true # å¦‚æœéœ€è¦ request / response bodyï¼Œè¯·è®¾ç½®ä¸º true
      timeout: 10 # script timeout in second (optional)

script-providers:
  weather-us-aqi:
    # è¿œç¨‹èµ„æºæ¨¡å¼
    # åŸºæœ¬ä¸Šè®¢é˜…åˆ«äººå·²ç»å†™å¥½çš„å°±å¤Ÿäº†
    url: https://raw.githubusercontent.com/STASH-NETWORKS-LIMITED/stash-example/main/script/iOS15_Weather_AQI_Standard.js
    interval: 86400
  rewrite:
    # inlineæ¨¡å¼ï¼Œä»…æ¨èä½œä¸ºå¼€å‘ä½¿ç”¨
    # æ³¨æ„rewriteä¹Ÿæ˜¯nameï¼Œä¸æ˜¯å…³é”®è¯
    content: >
      $httpClient.get(
        {
          url: "https://httpbin.org/anything",
          headers: {
            "content-type": "application/json",
          },
          body: "{}",
        },
        function (error, response, body) {
          if (error) {
            console.log(error);
            $done();
            return;
          }
          console.log(response.status);
          console.log(JSON.stringify(response.headers));
          console.log(body);
          $done({ body });
        }
      );

# --------------------------------------------------

# Clash çš„ Script Shortcutï¼Œè®© user å¯ä»¥åœ¨ Rule æ¨¡å¼ä¸‹ä½¿ç”¨éƒ¨åˆ† Script çš„åŠŸèƒ½
script:
  shortcuts: # ä½¿ç”¨ Python è„šæœ¬ç¼–å†™è‡ªå®šä¹‰è§„åˆ™
    # 4483 ä¸ 9305 ä¸º BiliBili çš„ QUIC CDN
    quic: network == 'udp' and (dst_port == 443 or dst_port == 4483 or dst_port == 9305) # å¯ä»¥åœ¨ rule ä¸­å¼•ç”¨
# ä½¿ç”¨æ–¹æ³•ä¸ºåœ¨ä¸‹é¢çš„ rules é‡Œé¢æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š
# rules:
#   - SCRIPT,quic,REJECT

# DNS æœåŠ¡å™¨å’Œå»ºç«‹è¿æ¥æ—¶çš„é™æ€ Hosts, è¡Œä¸ºç±»ä¼¼äº/etc/hostsï¼Œä»…åœ¨ dns.enhanced-mode æ¨¡å¼ä¸º redir-host ç”Ÿæ•ˆ
# æ”¯æŒé€šé…ç¬¦åŸŸå (ä¾‹å¦‚: *.clash.dev, *.foo.*.example.com)
# ä¸ä½¿ç”¨é€šé…ç¬¦çš„åŸŸåä¼˜å…ˆçº§é«˜äºä½¿ç”¨é€šé…ç¬¦çš„åŸŸå (ä¾‹å¦‚: foo.example.com > *.example.com > .example.com)
# æ³¨æ„: +.foo.com çš„æ•ˆæœç­‰åŒäº .foo.com å’Œ foo.com
# åªæœ‰éœ€è¦çš„æ—¶å€™å†å¼€å¯
hosts:
  '*.clash.dev': 127.0.0.1
  '.dev': 127.0.0.1
  'alpha.clash.dev': '::1'

profile:
  # Store the `select` results in $HOME/.config/clash/.cache
  # set false If you don't want this behavior
  # when two different configurations have groups with the same name, the selected values are shared
  store-selected: false

  # persistence fakeip
  store-fake-ip: true

# DNS æœåŠ¡å™¨é…ç½® (å¯é€‰ï¼›è‹¥ä¸é…ç½®ï¼Œç¨‹åºå†…ç½®çš„ DNS æœåŠ¡ä¼šè¢«å…³é—­)
dns:

# --------------------------------------------------
# Clash ç›¸å…³é…ç½®ï¼ŒStash æ–‡æ¡£æœªæ³¨æ˜æ”¯æŒ

# Stash åªè¦é…ç½®äº† dns å­—æ®µï¼Œå°±æ‰“å¼€ dns åŠŸèƒ½ï¼Œè€Œ Clash å•ç‹¬è®¾ç½®äº†å¼€å…³å‘½ä»¤å’Œä¾¦å¬ç«¯å£ï¼Œä»¥åŠå¯¹ IPV6 çš„æ”¯æŒ
  enable: false
  listen: 0.0.0.0:53
  # ipv6: false # when the false, response to AAAA questions will be empty

# --------------------------------------------------

  # ä»¥ä¸‹å¡«å†™çš„ DNS æœåŠ¡å™¨å°†ä¼šè¢«ç”¨æ¥è§£æ DNS æœåŠ¡çš„åŸŸåï¼Œè¿™æ˜¯å› ä¸º doh ç±»å‹çš„åŠ å¯† DNS æŸ¥è¯¢æœ¬èº«éœ€è¦ç”¨æ˜æ–‡çš„ IP ç±»å‹çš„ DNS æœåŠ¡å™¨æ¥è§£æå…¶çœŸå®åœ°å€
  # ä¾‹å¦‚ç”¨ 223.5.5.5 æ¥è§£æ https://dns.alidns.com/dns-query çš„çœŸå®åœ°å€ï¼Œç„¶åå‘å…¶å‘é€åŠ å¯† DNS æŸ¥è¯¢
  # ä»…å¡«å†™ DNS æœåŠ¡å™¨çš„ IP åœ°å€
  default-nameserver:
    - 223.5.5.5
    - 114.114.114.114
    - system # ä½¿ç”¨ iOS ç³»ç»Ÿ DNS ï¼Œæ³¨æ„ Clash å¹¶ä¸æ”¯æŒ system å­—æ®µ
  # æ”¯æŒ UDP / TCP / DoT / DoH åè®®çš„ DNS æœåŠ¡ï¼Œå¯ä»¥æŒ‡æ˜å…·ä½“çš„è¿æ¥ç«¯å£å·ã€‚
  # æ‰€æœ‰ DNS è¯·æ±‚å°†ä¼šç›´æ¥å‘é€åˆ°æœåŠ¡å™¨ï¼Œä¸ç»è¿‡ä»»ä½•ä»£ç†ã€‚
  # Clash ä¼šä½¿ç”¨æœ€å…ˆè·å¾—çš„è§£æè®°å½•å›å¤ DNS è¯·æ±‚
  nameserver:
    # ä¸å»ºè®®é…ç½®è¶…è¿‡ 2 ä¸ª DNS æœåŠ¡å™¨ï¼Œä¼šå¢åŠ ç³»ç»ŸåŠŸè€—
    - 114.114.114.114 # Clash default value
    - 8.8.8.8 # Clash default value
    - tls://dns.rubyfish.cn:853 # DNS over TLS
    - dhcp://en0 # DNS from DHCP ï¼ŒClash æ–‡æ¡£ä¸­æŒ‡å®šçš„ç±»å‹ï¼ŒStash æ–‡æ¡£ä¸­å¹¶æœªæ³¨æ˜æ”¯æŒ
    - https://doh.pub/dns-query # DNS over HTTPS
    - https://dns.alidns.com/dns-query
    - quic://dns.adguard.com:784 # Stash æ–‡æ¡£ä¸­æŒ‡å®šçš„ç±»å‹ï¼ŒClash æ–‡æ¡£ä¸­å¹¶æœªæ³¨æ˜æ”¯æŒ
    - system # ä½¿ç”¨ iOS ç³»ç»Ÿ DNS ï¼ŒClash æ–‡æ¡£å¹¶æœªæ³¨æ˜æ”¯æŒ system ç±»å‹

  # å¯¹éƒ¨åˆ†åŸŸåä½¿ç”¨å•ç‹¬çš„ DNS æœåŠ¡å™¨
  nameserver-policy:
    "www.baidu.com": 114.114.114.114 # Clash æ–‡æ¡£ä¸­çš„ç”¨æ³•ä¸º 'www.baidu.com': '114.114.114.114'ï¼Œä½¿ç”¨å•å¼•å·
    "+.internal.crop.com": system # system ç±»å‹ï¼ŒClash æ–‡æ¡£å¹¶æœªæ³¨æ˜æ”¯æŒ system ç±»å‹

# --------------------------------------------------
# Clash ç›¸å…³é…ç½®ï¼ŒStash æ–‡æ¡£æœªæ³¨æ˜æ”¯æŒ

  enhanced-mode: fake-ip # or redir-host
  fake-ip-range: 198.18.0.1/16 # Fake IP addresses pool CIDR
  use-hosts: true # lookup hosts and return IP record

# --------------------------------------------------

  # åœ¨ä»¥ä¸‹åˆ—è¡¨çš„åŸŸåå°†ä¸ä¼šè¢«è§£æä¸º fake ipï¼Œè¿™äº›åŸŸåç›¸å…³çš„è§£æè¯·æ±‚å°†ä¼šè¿”å›å®ƒä»¬çœŸå®çš„ IP åœ°å€
  fake-ip-filter:
    # ä»¥ä¸‹åŸŸååˆ—è¡¨å‚è€ƒè‡ª vernesong/OpenClash é¡¹ç›®ï¼Œå¹¶ç”± Hackl0us æ•´ç†è¡¥å……
    - "*.lan"
    - "*.localdomain"
    - "*.example"
    - "*.invalid"
    - "*.localhost"
    - "*.test"
    - "*.local"
    - "*.home.arpa"
    - "time.*.com"
    - "time.*.gov"
    - "time.*.edu.cn"
    - "time.*.apple.com"
    - "time1.*.com"
    - "time2.*.com"
    - "time3.*.com"
    - "time4.*.com"
    - "time5.*.com"
    - "time6.*.com"
    - "time7.*.com"
    - "ntp.*.com"
    - "ntp1.*.com"
    - "ntp2.*.com"
    - "ntp3.*.com"
    - "ntp4.*.com"
    - "ntp5.*.com"
    - "ntp6.*.com"
    - "ntp7.*.com"
    - "*.time.edu.cn"
    - "*.ntp.org.cn"
    - "+.pool.ntp.org"
    - "time1.cloud.tencent.com"
    - "music.163.com"
    - "*.music.163.com"
    - "*.126.net"
    - "musicapi.taihe.com"
    - "music.taihe.com"
    - "songsearch.kugou.com"
    - "trackercdn.kugou.com"
    - "*.kuwo.cn"
    - "api-jooxtt.sanook.com"
    - "api.joox.com"
    - "joox.com"
    - "y.qq.com"
    - "*.y.qq.com"
    - "streamoc.music.tc.qq.com"
    - "mobileoc.music.tc.qq.com"
    - "isure.stream.qqmusic.qq.com"
    - "dl.stream.qqmusic.qq.com"
    - "aqqmusic.tc.qq.com"
    - "amobile.music.tc.qq.com"
    - "*.xiami.com"
    - "*.music.migu.cn"
    - "music.migu.cn"
    - "*.msftconnecttest.com"
    - "*.msftncsi.com"
    - "msftconnecttest.com"
    - "msftncsi.com"
    - "localhost.ptlogin2.qq.com"
    - "localhost.sec.qq.com"
    - "+.srv.nintendo.net"
    - "+.stun.playstation.net"
    - "xbox.*.microsoft.com"
    - "xnotify.xboxlive.com"
    - "+.battlenet.com.cn"
    - "+.wotgame.cn"
    - "+.wggames.cn"
    - "+.wowsgame.cn"
    - "+.wargaming.net"
    - "proxy.golang.org"
    - "stun.*.*"
    - "stun.*.*.*"
    - "+.stun.*.*"
    - "+.stun.*.*.*"
    - "+.stun.*.*.*.*"
    - "heartbeat.belkin.com"
    - "*.linksys.com"
    - "*.linksyssmartwifi.com"
    - "*.router.asus.com"
    - "mesu.apple.com"
    - "swscan.apple.com"
    - "swquery.apple.com"
    - "swdownload.apple.com"
    - "swcdn.apple.com"
    - "swdist.apple.com"
    - "lens.l.google.com"
    - "stun.l.google.com"
    - "+.nflxvideo.net"
    - "*.square-enix.com"
    - "*.finalfantasyxiv.com"
    - "*.ffxiv.com"

# --------------------------------------------------
# Clash ç›¸å…³é…ç½®ï¼ŒStash æ–‡æ¡£æœªæ³¨æ˜æ”¯æŒ

# When `fallback` is present, the DNS server will send concurrent requests to the servers 
# in this section along with servers in `nameservers`.
# The answers from fallback servers are used when the GEOIP country is not `CN`.
  fallback:
    - tcp://1.1.1.1

# If IP addresses resolved with servers in `nameservers` are in the specified subnets below,
# they are considered invalid and results from `fallback` servers are used instead.
# 'the specified subnet below' is 'ipcidr' and 'domain'.

# IP address resolved with servers in `nameserver` is used when `fallback-filter.geoip` is true
# and when GEOIP of the IP address is `CN`.

# If `fallback-filter.geoip` is false, results from `nameserver` nameservers are always used
# if not match `fallback-filter.ipcidr`.

# This is a countermeasure against DNS pollution attacks.
  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4
    domain:
      - '+.google.com'
      - '+.facebook.com'
      - '+.youtube.com'

# --------------------------------------------------

proxies:
  # shadowsocks
  # æ”¯æŒåŠ å¯†æ–¹å¼ï¼š
  #   aes-128-gcm aes-192-gcm aes-256-gcm
  #   aes-128-cfb aes-192-cfb aes-256-cfb
  #   aes-128-ctr aes-192-ctr aes-256-ctr
  #   rc4-md5 chacha20 chacha20-ietf xchacha20
  #   chacha20-ietf-poly1305 xchacha20-ietf-poly1305

  - name: "ss1"
    type: ss
    server: server
    port: 443
    cipher: chacha20-ietf-poly1305
    password: "password"
    # udp: true

  - name: "ss2"
    type: ss
    server: server
    port: 443
    cipher: AEAD_CHACHA20_POLY1305
    password: "password"
    plugin: obfs
    plugin-opts:
      mode: tls # æ··æ·†æ¨¡å¼ï¼Œå¯ä»¥é€‰æ‹© http æˆ– tls
      host: bing.com # æ··æ·†åŸŸåï¼Œéœ€è¦å’ŒæœåŠ¡å™¨é…ç½®ä¿æŒä¸€è‡´

  - name: "ss3"
    type: ss
    server: server
    port: 443
    cipher: AEAD_CHACHA20_POLY1305
    password: "password"
    plugin: v2ray-plugin
    plugin-opts:
      mode: websocket # æš‚æ—¶ä¸æ”¯æŒ QUIC åè®®
      # tls: true # wss
      # skip-cert-verify: true
      # host: bing.com
      # path: "/"
      # headers:
      #   custom: value

  # vmess
  # æ”¯æŒåŠ å¯†æ–¹å¼ï¼šauto / aes-128-gcm / chacha20-poly1305 / none

  - name: "vmess"
    type: vmess
    server: server
    port: 443
    uuid: d0529668-8835-11ec-a8a3-0242ac120002
    alterId: 32
    cipher: auto
    # udp: true
    # tls: true
    # skip-cert-verify: true
    # servername: example.com # ä¼˜å…ˆçº§é«˜äº wss host
    # network: ws
    # ws-opts:
    #   path: /path
    #   headers:
    #     Host: v2ray.com
    #   max-early-data: 2048
    #   early-data-header-name: Sec-WebSocket-Protocol

  - name: "vmess-h2"
    type: vmess
    server: server
    port: 443
    uuid: d0529668-8835-11ec-a8a3-0242ac120002
    alterId: 32
    cipher: auto
    network: h2
    tls: true
    h2-opts:
      host:
        - http.example.com
        - http-alt.example.com
      path: /

  - name: "vmess-http"
    type: vmess
    server: server
    port: 443
    uuid: d0529668-8835-11ec-a8a3-0242ac120002
    alterId: 32
    cipher: auto
    # udp: true
    # network: http
    # http-opts:
    #   # method: "GET"
    #   # path:
    #   #   - '/'
    #   #   - '/video'
    #   # headers:
    #   #   Connection:
    #   #     - keep-alive

  - name: "vmess-grpc"
    server: server
    port: 443
    type: vmess
    uuid: d0529668-8835-11ec-a8a3-0242ac120002
    alterId: 32
    cipher: auto
    network: grpc
    tls: true
    servername: example.com
    # skip-cert-verify: true
    grpc-opts:
      grpc-service-name: "example"

  # socks5

  - name: "socks"
    type: socks5
    server: server
    port: 443
    # username: username
    # password: password
    # tls: true
    # skip-cert-verify: true
    # udp: true

  # http
  - name: "http"
    type: http
    server: server
    port: 443
    # username: username
    # password: password
    # tls: true # https
    # skip-cert-verify: true

  # snell
  - name: "snell"
    type: snell
    server: server
    port: 44046
    psk: yourpsk
    udp: true # éœ€è¦ v3 ä»¥ä¸ŠæœåŠ¡ç«¯
    version: 3
    # obfs-opts:
    # mode: http # æˆ– tls
    # host: bing.com

  # Trojan
  - name: "trojan"
    type: trojan
    server: server
    port: 443
    password: yourpsk
    # udp: true
    # sni: example.com # Server Name Indicationï¼Œå¦‚æœç©ºä¼šä½¿ç”¨ server ä¸­çš„å€¼
    # alpn:
    #   - h2
    #   - http/1.1
    # skip-cert-verify: true

# --------------------------------------------------
# Stash ç›¸å…³é…ç½®ï¼ŒClash æ–‡æ¡£æœªæ³¨æ˜æ”¯æŒ

  - name: trojan-grpc
    server: server
    port: 443
    type: trojan
    password: "example"
    network: ws
    sni: example.com
    # skip-cert-verify: true
    udp: true
    # ws-opts:
      # path: /path
      # headers:
      #   Host: example.com

# --------------------------------------------------

# --------------------------------------------------
# Stash ç›¸å…³é…ç½®ï¼ŒClash æ–‡æ¡£æœªæ³¨æ˜æ”¯æŒ

  # hysteria https://github.com/HyNetwork/hysteria/wiki/%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95
  - name: "hysteria"
    type: hysteria
    server: server
    port: 443
    up-speed: 100 # ä¸Šä¼ å¸¦å®½ï¼ˆå•ä½ï¼šMbpsï¼‰
    down-speed: 100 # ä¸‹è½½å¸¦å®½ï¼ˆå•ä½ï¼šMbpsï¼‰
    # auth: "" # bytes encoded in base64
    # obfs: ""
    # obfs-protocol: "" # wechat-video or blank
    # udp: true
    # sni: example.com # Server Name Indicationï¼Œå¦‚æœç©ºä¼šä½¿ç”¨ server ä¸­çš„å€¼
    # alpn:
    #   - hysteria
    # skip-cert-verify: true

# --------------------------------------------------

  # ShadowsocksR
  # æ”¯æŒçš„åŠ å¯†æ–¹å¼: SS ä¸­æ”¯æŒçš„æ‰€æœ‰æµåŠ å¯†æ–¹å¼
  # æ”¯æŒçš„æ··æ·†æ–¹å¼:
  #   plain http_simple http_post
  #   random_head tls1.2_ticket_auth tls1.2_ticket_fastauth
  # æ”¯æŒçš„åè®®:
  #   origin auth_sha1_v4 auth_aes128_md5
  #   auth_aes128_sha1 auth_chain_a auth_chain_b
  - name: "ssr"
    type: ssr
    server: server
    port: 443
    cipher: chacha20-ietf
    password: "password"
    obfs: tls1.2_ticket_auth
    protocol: auth_sha1_v4
    # obfs-param: domain.tld
    # protocol-param: "#"
    # udp: true

# --------------------------------------------------
# Stash ç›¸å…³é…ç½®ï¼ŒClash æ–‡æ¡£æœªæ³¨æ˜æ”¯æŒ

  - name: "vless"
    type: vless
    server: server
    port: 443
    uuid: d0529668-8835-11ec-a8a3-0242ac120002
    # flow: xtls-rprx-direct
    # skip-cert-verify: true
    # network: h2
    # tls: true
    # ws-opts:
    #   path: /path
    #   headers:
    #     Host: v2ray.com
    # grpc-opts:
    #   grpc-service-name: "example"
    # h2-opts:
    #   host:
    #     - http.example.com
    #     - http-alt.example.com
    #   path: /

# --------------------------------------------------

proxy-groups:
  # ä»£ç†çš„è½¬å‘é“¾, åœ¨ proxies ä¸­ä¸åº”è¯¥åŒ…å« relay. ä¸æ”¯æŒ UDP.
  # æµé‡: clash <-> http <-> vmess <-> ss1 <-> ss2 <-> äº’è”ç½‘
  - name: "relay"
    type: relay
    icon: https://raw.githubusercontent.com/Koolson/Qure/master/IconSet/Color/Direct.png
    proxies:
      - http
      - vmess
      - ss1
      - ss2

  # url-test å¯ä»¥è‡ªåŠ¨é€‰æ‹©ä¸æŒ‡å®š URL æµ‹é€Ÿåï¼Œå»¶è¿Ÿæœ€çŸ­çš„æœåŠ¡å™¨
  - name: "auto"
    type: url-test
    proxies:
      - ss1
      - ss2
      - vmess
    url: "http://www.gstatic.com/generate_204"
    interval: 300

  # fallback å¯ä»¥å°½é‡æŒ‰ç…§ç”¨æˆ·ä¹¦å†™çš„æœåŠ¡å™¨é¡ºåºï¼Œåœ¨ç¡®ä¿æœåŠ¡å™¨å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œè‡ªåŠ¨é€‰æ‹©æœåŠ¡å™¨
  - name: "fallback-auto"
    type: fallback
    proxies:
      - ss1
      - ss2
      - vmess
    url: "http://www.gstatic.com/generate_204"
    interval: 300

  # load-balance å¯ä»¥ä½¿ç›¸åŒ eTLD è¯·æ±‚åœ¨åŒä¸€æ¡ä»£ç†çº¿è·¯ä¸Š
  - name: "load-balance"
    type: load-balance
    proxies:
      - ss1
      - ss2
      - vmess
    url: "http://www.gstatic.com/generate_204"
    interval: 300

  # select ç”¨æ¥å…è®¸ç”¨æˆ·æ‰‹åŠ¨é€‰æ‹© ä»£ç†æœåŠ¡å™¨ æˆ– æœåŠ¡å™¨ç»„
  # æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ RESTful API å»åˆ‡æ¢æœåŠ¡å™¨ï¼Œè¿™ç§æ–¹å¼æ¨èåœ¨ GUI ä¸­ä½¿ç”¨
  - name: Proxy
    type: select
    proxies:
      - ss1
      - ss2
      - vmess
      - auto

# --------------------------------------------------
# Stash ç›¸å…³é…ç½®ï¼ŒClash æ–‡æ¡£æœªæ³¨æ˜æ”¯æŒ

  # åŸºäº SSID çš„ç­–ç•¥ï¼Œæ–¹ä¾¿åœ¨ç‰¹æ®Šç½‘ç»œç¯å¢ƒä¸‹ä½¿ç”¨ç‰¹å®šçš„ä»£ç†
  - name: ssid-group
    type: select # ç±»å‹å¿…é¡»ä¸º selectï¼Œå…¼å®¹åŸç‰ˆ clash é…ç½®
    proxies:
      - ss1
      - ss2
      - DIRECT
    ssid-policy:
      # åœ¨ SSID ä¸º office çš„ Wi-Fi ä¸­è‡ªåŠ¨åˆ‡æ¢ä¸º ss1 ç­–ç•¥
      # åœ¨ SSID ä¸º home çš„ Wi-Fi ä¸­è‡ªåŠ¨åˆ‡æ¢ä¸º ss2 ç­–ç•¥
      # å…¶ä»–çš„ SSID ä»¥åŠèœ‚çªæ•°æ®ï¼Œé»˜è®¤ä¸º DIRECT
      office: ss1
      home: ss2
      default: DIRECT

# --------------------------------------------------

# --------------------------------------------------
# Clash ç›¸å…³é…ç½®ï¼ŒStash æ–‡æ¡£æœªæ³¨æ˜æ”¯æŒ

  # direct to another infacename
  - name: en1
    type: select
    interface-name: en1
    proxies:
      - DIRECT

# --------------------------------------------------

  - name: UseProvider
    type: select
    use:
      - provider1
    proxies:
      - Proxy
      - DIRECT



proxy-providers:

# --------------------------------------------------
# Stash ç›¸å…³é…ç½®ï¼Œæ˜¯ Clash æ–‡æ¡£çš„å­é›†ï¼Œå®Œæ•´ Clash æ–‡æ¡£é…ç½®ä¸‹é¢ç»™å‡º

  provider1:
    url: https://raw.githubusercontent.com/STASH-NETWORKS-LIMITED/stash-example/main/config.yaml
    interval: 3600
    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204

# --------------------------------------------------

# --------------------------------------------------
# Clash æ–‡æ¡£ä¸­çš„å®Œæ•´é…ç½®

  provider1:
    type: http
    url: "url"
    interval: 3600
    path: ./provider1.yaml
    health-check:
      enable: true
      interval: 600
      # lazy: true
      url: http://www.gstatic.com/generate_204
  test:
    type: file
    path: /test.yaml
    health-check:
      enable: true
      interval: 36000
      url: http://www.gstatic.com/generate_204

# --------------------------------------------------

# ç›®å‰ Clash Premium Core æ”¯æŒ filterï¼ŒStash å½“ç„¶ä¹Ÿæ”¯æŒï¼Œä¸è¿‡æ–‡æ¡£ä¸­éƒ½æœªæåŠ
# é”šç‚¹æ˜¯ YAML çš„è¯­æ³•æ”¯æŒ
  #å…¨éƒ¨èŠ‚ç‚¹
  All: &All #å»ºç«‹é”šç‚¹
    type: http
    url: "https://api.v1.mk/sub?target=clash&url=ä½ çš„è®¢é˜…é“¾æ¥&list=true&udp=true"
    # å¯ä»¥ä½¿ç”¨ä»»æ„ç±»å‹çš„é“¾æ¥æ›¿æ¢ä¸Šé¢æ–‡å­—ï¼Œå¤šä¸ªé“¾æ¥ä½¿ç”¨è‹±æ–‡ç¬¦å·çš„ç«–æ |éš”å¼€ä¸€èµ·å†™ä¸Šå³å¯
    # subconverter åç«¯é“¾æ¥
    interval: 3600
    path: ./all.yaml
    health-check:
      enable: true
      interval: 600
      url: http://www.gstatic.com/generate_204

  #ç¾å›½èŠ‚ç‚¹    
  US:
    <<: *All #å¼•ç”¨é”šç‚¹å†…å®¹
    filter: ç¾|ğŸ‡ºğŸ‡²|US|(?i)States|American
    
  #é¦™æ¸¯èŠ‚ç‚¹
  HK:
    <<: *All
    filter: æ¸¯|ğŸ‡­ğŸ‡°|HK|(?i)Hong

  #æ—¥æœ¬èŠ‚ç‚¹
  JP:
    <<: *All
    filter: æ—¥|ğŸ‡¯ğŸ‡µ|ä¸œäº¬|JP|(?i)Japan
 
  #å°æ¹¾èŠ‚ç‚¹
  TW:
    <<: *All
    filter: å°|ğŸ‡¨ğŸ‡³|ğŸ‡¹ğŸ‡¼|æ¹¾|TW|(?i)Taiwan

rule-providers:
  # ä¸‹é¢çš„é…ç½®éƒ½æ˜¯ Stash æ–‡æ¡£ä¸­çš„é…ç½®ï¼Œç›¸æ¯”è€Œè¨€ï¼ŒClash æ–‡æ¡£ä¸­çš„é…ç½®å¤šäº† type å’Œ path ä¸¤ä¸ªå­—æ®µ
  proxy-domain:
    behavior: domain # ä½¿ç”¨ domain ç±»è§„åˆ™é›†ï¼Œå¯ä»¥ä½¿åŒ¹é…æ›´é«˜æ•ˆ
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt
    interval: 86400

  proxy-domain-text:
    behavior: domain-text # æ¨èä½¿ç”¨ text æ ¼å¼
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/surge-rules@release/proxy.txt
    interval: 86400

  lan-cidr:
    behavior: ipcidr
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt
    interval: 86400

  ip-cidr-text:
    behavior: ipcidr-text
    url: https://cdn.jsdelivr.net/gh/17mon/china_ip_list@master/china_ip_list.txt
    interval: 86400

  apple-direct:
    behavior: classical # ä¸æ¨èä½¿ç”¨ classical ç±»è§„åˆ™é›†
    url: "https://cdn.jsdelivr.net/gh/Hackl0us/SS-Rule-Snippet@master/Rulesets/Clash/Basic/Apple-direct.yaml"
    interval: 3600

rules:
  - DOMAIN-SUFFIX,google.com,Proxy
  - DOMAIN-KEYWORD,google,Proxy
  - DOMAIN,google.com,Proxy
  - DOMAIN-SUFFIX,ad.com,REJECT
  - SRC-IP-CIDR,192.168.1.201/32,DIRECT
  # optional param "no-resolve" for IP rules (GEOIP, IP-CIDR, IP-CIDR6)
  - IP-CIDR,127.0.0.0/8,DIRECT
  - DST-PORT,80,DIRECT
  - SRC-PORT,7777,DIRECT
  - SCRIPT,quic,REJECT
  - RULE-SET,proxy-domain,Proxy
  - RULE-SET,apple-direct,DIRECT
  - RULE-SET,lan-cidr,DIRECT
  - RULE-SET,ip-cidr-text,DIRECT
  - GEOIP,CN,DIRECT
  - MATCH,Proxy
